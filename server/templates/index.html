<!DOCTYPE html>
<meta charset="utf-8">
<style>
	.line{
		fill: none;
		stroke: steelblue;
		stroke-width: 2px;
	}

	.area{
		stroke: #000;
		stroke-width: 0.6;
		stroke-linejoin: round;
		opacity: 0.5
	}

	div.tooltip {	
	   	position: absolute;			
	        text-align: center;			
		width: 60px;					
		height: 28px;					
		padding: 2px;				
		font: 12px sans-serif;		
		background: lightsteelblue;	
		border: 0px;		
		border-radius: 8px;			
		pointer-events: none;			
	}

</style>
	<head>
		<script src="https://d3js.org/d3.v5.min.js"></script>
		<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<script src="http://code.jquery.com/jquery.js"></script>
		<link href="{{ url_for('static', filename = "css/bootstrap.css")}}" rel="stylesheet" media="screen">
		<link rel="stylesheet" href="/resources/demos/style.css">
		<script src="{{ url_for('static', filename = "bootstrap.js") }}"></script>
		<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<script>
				    $( function() {
					    $( "#datepicker" ).datepicker({
						    dateFormat: "yy-mm-dd",
						    minDate: new Date('2019-03-26'),
					    	    maxDate: new Date('2019-05-11')
					    });
					      } );
  </script>
	</head>
	<body>
		<div class="container">
			<br></br>
			<form class = 'user-input' >
				<div class="form-group">
					Date: <input style="display: inline" value="2019-03-25" type="text" id="datepicker" name='date'>
			 		<button style="display: inline" type="submit" class="btn btn-primary">Submit</button>
				</div>
			</form>
			<svg id="arcs"></svg>	
		</div>	
		<div class="container">
			<p style="color: #515151; font-size:20px">Density plot of Day and Month</p><br/>
			Feature: <select id="featureSelect" class="mdb-select md-form colorful-select dropdown-primary">
				<option value="0" selected="selected">d1</option>
				{% for i in range(1, len) %}
					<option value={{ i }}>{{ features[i] }}</option>
				{% endfor %}
		   	</select>
			<br></br>
			<svg id="density"></svg>
		 </div> 
	<script>
		var margin = {top: 20, right: 20, bottom:20, left: 30},
		    width = 1000 - margin.right - margin.left,
		    height = 700 - margin.top - margin.bottom;
		var arc = {startx: 250, starty: 200, spacingx: 200, padding: 80}	
		var tau = 2*Math.PI;
		var radius = {"inner" : 50, "outer" : 70};
		var arc_fore = d3.arc()
			.innerRadius(radius.inner)
			.outerRadius(radius.outer)
			.startAngle(0)
			.endAngle(tau);

		var arc_back = d3.arc()
			.innerRadius(radius.inner)
			.outerRadius(radius.outer)
			.startAngle(function(d) {return (-0.25+(d.mean/d.global_max))*tau; })
			.endAngle(0.75*tau);

		var svgArc = d3.select("#arcs")
			.attr("width", width + margin.right + margin.left)
			.attr("height", height + margin.top + margin.bottom);

		svgArc.append("text")
			.text("Day Highlights")
			.attr("class", "title")
			.attr("x", 0)
			.attr("y", margin.top+10)
			.attr("fill", "#515151")
			.attr("font-size", 20);
		
		var div = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);
	
		function handleMouseOver(d, i){
			div.transition()
				.duration(400)
				.style("opacity", 0.9);
			
			div.html("Average<br/>"+d.mean.toFixed(2))
				.style("left", (5+d3.event.pageX)+"px")
				.style("top", (d3.event.pageY - 20) + "px");
		};


		function handleMouseOut(d, i){
			div.transition()
				.duration(400)
				.style("opacity", 0);
		}

		function getY(d){
			if(d<3)
				return arc.starty;
			else
				return 2*arc.starty+arc.padding;
		}

		function getX(d){
			return ((d%3)*arc.startx)+arc.spacingx;
		}

		function drawArcs(url){
			d3.json(url).then(function(data){
			
			d3.selectAll(".g-arcs").remove();
			d3.selectAll(".g-keys").remove();
			d3.selectAll(".g-minmax").remove();


			var svg = svgArc.selectAll("g arcs")
				.data(d3.values(data.weather))
				.enter()
				.append("g")
				.attr("class", "g-arcs");
			
			svg.attr("transform", function(d, i) {return "translate("+getX(i)+","+getY(i)+")";})
				.append("path")
				.attr("class", "arc1")
				.attr("d", arc_fore)
				.style("fill", "orange")
				.on("mouseover", handleMouseOver)
				.on("mouseout", handleMouseOut);

			svg.attr("transform", function(d, i) {return "translate("+getX(i)+","+getY(i)+")";})
				.append("path")
				.attr("class", "arc2")
				.attr("d", arc_back)
				.style("fill", "#ddd");

			svg.attr("transform", function(d, i) {return "translate("+getX(i)+","+getY(i)+")";})
				.append("text")
				.attr("class", "text2")
				.text(function(d) {return d.mean.toFixed(2);})
				.attr("text-anchor", "middle");

			var svgKeys = svgArc.selectAll("g text-keys")
				.data(d3.keys(data.weather))
				.enter()
				.append("g")
				.attr("class", "g-keys")
				.attr("transform", function(d, i) {return "translate("+getX(i)+","+(getY(i)-100)+")";});

			var svg3 = svgArc.selectAll("g text-minmax")
				.data(d3.values(data.weather))
				.enter()
				.append("g")
				.attr("transform", function(d, i) {return "translate("+getX(i)+","+(getY(i)+100)+")";})
				.attr("class", "g-minmax");
			svgKeys.append("text")
				.attr("class", "text1")
				.text(function(d) {return d;})
				.attr("text-anchor", "middle");


			svg3.append("text")
				.attr("class", "text3")
				.text(function(d) {return ("min "+d.min+" | max "+d.max);})
				.attr("text-anchor", "middle");

			
			})};
		
	</script>
	<script src="{{ url_for('static', filename = "density.js")}}"></script>
	<script src="{{ url_for('static', filename = "index.js")}}"></script>
		</div>
	</body>
</html>
